!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-gapi-auth2",["exports","@angular/core","rxjs","rxjs/operators","@angular/common"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-gapi-auth2"]={},e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common)}(this,(function(e,t,n,o,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var a=r(t),u=function(){function e(e){this.clientConfig=e,this.mocked=e.e2e}return e.prototype.getMocked=function(){return this.mocked},e.prototype.getClientConfig=function(){return this.clientConfig},e}(),s=function(e,t,n,o,i,r,a){this.id=e,this.firstName=t,this.lastName=n,this.email=o,this.avatar=i,this.idToken=r,this.tokenExpiresAt=a},c=new t.InjectionToken("ng-gapi.config"),g=function(){function e(e){this.gapiUrl="https://apis.google.com/js/platform.js",this.config=new u(e),this.loadGapi().subscribe()}return e.prototype.onLoad=function(){return this.loadGapi()},e.prototype.getConfig=function(){return this.config},e.prototype.isMocked=function(){return this.config.getMocked()},e.prototype.loadGapi=function(){var e=this;return new n.Observable((function(t){var n=document.createElement("script");n.src=e.gapiUrl,n.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(n),n.onload=function(){t.next(!0),t.complete()}}))},e}();g.ɵfac=function(e){return new(e||g)(a.ɵɵinject(c))},g.ɵprov=a.ɵɵdefineInjectable({token:g,factory:g.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&a.ɵsetClassMetadata(g,[{type:t.Injectable}],(function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c]}]}]}),null);var l=function(){function e(e){var t=this;this.googleApi=e,this.GoogleAuth=void 0,this.googleApi.onLoad().subscribe((function(){t.loadGoogleAuth2().subscribe()}))}return e.prototype.getAuth=function(e){var t=this;return void 0===e&&(e=!1),!this.GoogleAuth||e?this.googleApi.onLoad().pipe(o.mergeMap((function(){return t.loadGoogleAuth2()}))):n.of(this.GoogleAuth)},e.prototype.loadGoogleAuth2=function(){var e=this;return new n.Observable((function(t){gapi.load("auth2",(function(){gapi.auth2.init(e.googleApi.getConfig().getClientConfig()).then((function(n){e.GoogleAuth=n,t.next(n),t.complete()})).catch((function(e){return t.error(e)}))}))}))},e}();l.ɵfac=function(e){return new(e||l)(a.ɵɵinject(g))},l.ɵprov=a.ɵɵdefineInjectable({token:l,factory:l.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&a.ɵsetClassMetadata(l,[{type:t.Injectable}],(function(){return[{type:g}]}),null);var f=function(){function e(e,t,i){var r=this;this.googleAuth2LoaderService=e,this.googleApiLoaderService=t,this.ngZone=i,this._authState=new n.ReplaySubject(1),this._loginState=new n.ReplaySubject(1),this.SIGN_IN_EXPIRE_KEY="loginExpirationDate",this.googleApiLoaderService.isMocked()?this.signIn():this.googleApiLoaderService.onLoad().subscribe((function(){r.googleAuth2LoaderService.getAuth().subscribe((function(e){return r.authLoaded(e)}),(function(){return r.removeState()})),n.interval(12e5).pipe(o.tap((function(){return r.refreshToken()}))).subscribe()}))}return Object.defineProperty(e.prototype,"authState",{get:function(){return this._authState.asObservable()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loginState",{get:function(){return this._loginState.asObservable()},enumerable:!1,configurable:!0}),e.prototype.signIn=function(){var e=this;if(this.googleApiLoaderService.isMocked())this._loginState.next(JSON.parse(localStorage.getItem("user"))),this._authState.next(JSON.parse(localStorage.getItem("user")));else{var t=new Date,n=this.setTime(t,null,t.getMinutes()+5);localStorage.setItem(this.SIGN_IN_EXPIRE_KEY,n.toISOString());var o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);this.auth.signIn({prompt:"select_account",ux_mode:o?"popup":"redirect"}).then((function(){return e.fetchLoginData()}))}},e.prototype.signOut=function(){this.googleApiLoaderService.isMocked()||this.auth.signOut(),this.removeState()},e.prototype.fetchLoginData=function(){var e=this;return this.auth.currentUser.get().reloadAuthResponse().then((function(t){e.ngZone.run((function(){e._loginState.next(e.getProfile(t.id_token,t.expires_at)),e._authState.next(e.getProfile(t.id_token,t.expires_at))}))}))},e.prototype.refreshToken=function(){var e=this;return this.auth.currentUser.get().reloadAuthResponse().then((function(t){e.ngZone.run((function(){return e._authState.next(e.getProfile(t.id_token,t.expires_at))}))}))},e.prototype.authLoaded=function(e){(this.auth=e,this.auth.currentUser.get().isSignedIn())?(this.fetchLoginData(),localStorage.removeItem(this.SIGN_IN_EXPIRE_KEY)):new Date(localStorage.getItem(this.SIGN_IN_EXPIRE_KEY))>new Date?(this._loginState.next({type:"cookiesNotEnabled"}),this._authState.next(null)):this.removeState()},e.prototype.removeState=function(){this._authState.next(null),this._loginState.next(null)},e.prototype.getProfile=function(e,t){var n=this.auth.currentUser.get().getBasicProfile();return n?{id:n.getId(),email:n.getEmail(),firstName:n.getGivenName(),lastName:n.getFamilyName(),avatar:n.getImageUrl(),idToken:e,tokenExpiresAt:t}:null},e.prototype.setTime=function(e,t,n,o,i){var r=new Date(e);return"number"==typeof t&&r.setHours(t),"number"==typeof n&&r.setMinutes(n),"number"==typeof o&&r.setSeconds(o),"number"==typeof i&&r.setMilliseconds(i),r},e}();f.ɵfac=function(e){return new(e||f)(a.ɵɵinject(l),a.ɵɵinject(g),a.ɵɵinject(a.NgZone))},f.ɵprov=a.ɵɵdefineInjectable({token:f,factory:f.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&a.ɵsetClassMetadata(f,[{type:t.Injectable}],(function(){return[{type:l},{type:g},{type:a.NgZone}]}),null);var p=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[t,g,l,f]}},e}();p.ɵfac=function(e){return new(e||p)},p.ɵmod=a.ɵɵdefineNgModule({type:p}),p.ɵinj=a.ɵɵdefineInjector({imports:[[i.CommonModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&a.ɵɵsetNgModuleScope(p,{imports:[i.CommonModule]}),("undefined"==typeof ngDevMode||ngDevMode)&&a.ɵsetClassMetadata(p,[{type:t.NgModule,args:[{imports:[i.CommonModule]}]}],null,null),e.AuthData=s,e.GoogleApiConfig=u,e.GoogleApiLoaderService=g,e.GoogleAuth2LoaderService=l,e.GoogleAuthService=f,e.GoogleOauthModule=p,e.NG_GAPI_CONFIG=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-gapi-auth2.umd.min.js.map